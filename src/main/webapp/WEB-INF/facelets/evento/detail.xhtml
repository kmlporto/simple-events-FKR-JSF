<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:body>
    <div class="container">
        <h3>Detalhes do Evento</h3>
        <h4>#{eventos.evento.descricao}</h4>
        <h5 class="card-title">Local: #{eventos.evento.local}</h5>
        <div class="row">
            <p class="card-text col-md-3">Organizardor: #{eventos.evento.dono.email}</p>
            <p class="card-text col-md-3">Data: #{eventos.evento.data}</p>
            <p class="card-text col-md-3">Status: #{eventos.evento.status}</p>
        </div>

        <p:tabView>
            <p:tab title="Vagas">
                <div class="container">
                    <div class="row">
                        <c:if test="${loginBean.verificarLogado() and
                        loginBean.verificarTipo() and
                        loginBean.usuarioLogado.id != eventos.evento.dono.id and
                        eventos.evento.status.name() == 'CONFIRMADO'}">
                            <h:form id="candidatar">
                                <h:selectOneRadio id="vagaEscolhida" value="#{eventos.vagaEscolhida}">
                                    <f:selectItems value="#{eventos.getVagasDisponiveis()}" var="vaga"
                                                   itemLabel="#{vaga.especialidade.nome}"
                                                   itemValue="#{vaga.especialidade.nome}"/>
                                </h:selectOneRadio>
                                <h:commandButton value="Candidatar" action="#{eventos.candidatar()}"/>
                            </h:form>
                        </c:if>
                        <c:if test="${!loginBean.verificarLogado() or
                                !loginBean.verificarTipo() or
                                loginBean.usuarioLogado.id == eventos.evento.dono.id or
                                eventos.evento.status.name() != 'CONFIRMADO'}">
                            <div class="col-md-6">
                                <c:forEach var="vaga" items="#{eventos.evento.vagas}">
                                    <div>- ${vaga.qtdVagas} vagas para ${vaga.especialidade.nome}</div>
                                </c:forEach>
                            </div>
                        </c:if>
                    </div>
                </div>
            </p:tab>
            <p:tab title="Avaliação dos Participantes">
                <div class="row">
                    <c:if test="#{eventos.evento.status.name() == 'EXECUTADO'}">
                        <h:form styleClass="w-100">
                            <c:forEach var="vaga" items="#{eventos.evento.vagas}">
                                <c:forEach var="candidato" items="#{vaga.candidatoVaga}">
                                    <div class="flex-row">
                                        <div class="col-md-4">#{candidato.candidato.nome} - #{candidato.id}</div>
                                        <div class="col-md-4">
                                            <p:rating value="#{eventos.rating}" cancel="false" required="true"/>
                                        </div>
                                        <h:commandLink action="#{eventos.avaliar(candidato)}" styleClass="col-md-2">
                                            <i class="fa fa-play-circle"></i>
                                        </h:commandLink>
                                    </div>
                                </c:forEach>
                            </c:forEach>
                        </h:form>
                    </c:if>
                    <c:if test="#{eventos.evento.status.name() != 'EXECUTADO'}">
                        <c:forEach var="vaga" items="#{eventos.evento.vagas}">
                            <div class="col-md-6">
                                <c:forEach var="candidato" items="#{vaga.candidatoVaga}">
                                    <div>- Candidato #{candidato.candidato.nome} - nota: #{candidato.notaDesempenho}</div>
                                </c:forEach>
                            </div>
                        </c:forEach>
                    </c:if>
                </div>
            </p:tab>
            <p:tab title="Avaliação do Evento">
                <div class="row">
                    <div class="col-md-6">
                        <c:forEach var="avaliacao" items="#{eventos.evento.avaliacaoEventos}">
                            <div>#{avaliacao.notaAvaliacaoEvento}</div>
                        </c:forEach>
                    </div>
                </div>
            </p:tab>
        </p:tabView>
    </div>
</h:body>
</html>